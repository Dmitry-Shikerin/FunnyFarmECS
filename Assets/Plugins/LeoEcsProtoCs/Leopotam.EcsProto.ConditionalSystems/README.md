<p align="center">
    <img src="./logo.png" alt="Logo">
</p>

# Группировка систем в блоки с условным выполнением
Поддержка группировки систем в исполняемые по условию блоки для LeoECS Proto.

> **ВАЖНО!** Требует C#9 (или Unity >=2021.2).

> **ВАЖНО!** Зависит от: **Leopotam.EcsProto**, **Leopotam.EcsProto.QoL**.

> **ВАЖНО!** Не забывайте использовать `DEBUG`-версии билдов для разработки и `RELEASE`-версии билдов для релизов: все внутренние проверки/исключения будут работать только в `DEBUG`-версиях и удалены для увеличения производительности в `RELEASE`-версиях.

> **ВАЖНО!** Проверено на Unity 2021.3 (не зависит от нее) и содержит asmdef-описания для компиляции в виде отдельных сборок и уменьшения времени рекомпиляции основного проекта.


# Социальные ресурсы
[Официальный блог](https://leopotam.com)


# Установка


## В виде исходников
Поддерживается установка в виде исходников из архива, который надо распаковать в проект.


## Прочие источники
Официальные версии выпускаются для активных подписчиков в виде ссылок на актуальные версии.


# Основные типы


## Solver
Пользовательский класс, определяющий, будет исполняться группа систем или нет. Класс должен реализовать интерфейс `IConditionalSystemSolver`:
```c#
class SystemGroup1Solver : IConditionalSystemSolver {
    // Метод должен вернуть разрешение на исполнение
    // блока вложенных в группу систем.
    public bool Solve () {
        return UnityEngine.Random.Range (1, 100) > 50;
    }
}
```
> **ВАЖНО!** Поддерживается инъекция аспектов, сервисов и итераторов в поля экземпляра через пометку атрибутом `[DI]`. Для разрешения инъекции надо явно указать флаг при инициализации `ConditionalSystem`, подключение модуля `AutoInjectModule` не влияет на этот процесс.

## ConditionalSystem
Система, представляющая собой контейнер по типу `ProtoSystems` и позволяющая выполнять или пропускать выполнение `IProtoRunSystem`-систем, которые были в нее вложены:
```c#
class Solver1 : IConditionalSystemSolver {
    // Поле будет заполнено автоматически.
    [DI] Aspect1 _aspect1;

    public bool Solve () {
        return true;
    }
}
IProtoSystems systems = new ProtoSystems (new ProtoWorld (new Aspect1 ()));
systems
    .AddSystem (new ConditionalSystem (
        // Указываем solver, который будет разрешать
        // выполнение вложенных систем.
        new Solver1 (),
        // Разрешаем автоинъекцию в solver и вложенные системы,
        // иначе инъекции не будет даже при подключенном
        // AutoInjectModule-модуле.
        true,
        // Перечисляем вложенные системы, которые будут
        // срабатывать или нет по результатам работы solver-а.
        new Test1System (),
        new Test2System (),
        new Test3System ()
    ))
    .AddSystem (new Test4System ())
    .Init ();
```


# Лицензия
Расширение выпускается под коммерческой лицензией, [подробности тут](./LICENSE.md).
