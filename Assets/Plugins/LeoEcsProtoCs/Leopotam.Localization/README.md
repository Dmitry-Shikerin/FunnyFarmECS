<p align="center">
    <img src="./logo.png" alt="Logo">
</p>

# Localization
Поддержка CSV-локализации.

> **ВАЖНО!** Требует C#9 (или Unity >=2021.2).

> **ВАЖНО!** Зависит от: **Leopotam.Serialization.Csv**.

> **ВАЖНО!** Проверено на Unity 2021.3 (не зависит от нее) и содержит asmdef-описания для компиляции в виде отдельных сборок и уменьшения времени рекомпиляции основного проекта.


# Социальные ресурсы
[Официальный блог](https://leopotam.com)


# Установка


## В виде исходников
Поддерживается установка в виде исходников из архива, который надо распаковать в проект.


## Прочие источники
Официальные версии выпускаются для активных подписчиков в виде ссылок на актуальные версии.


# Использование


## Инициализация
Локализация представлена классом `Localization`, содержащим в себе набор `Категорий`. Каждая `Категория` (страница) представляет собой таблицу данных,
где первый столбец играет роль ключей значений, а первая строка содержит имена-ключи языков.


| KEY   | Russian   | English     |
|-------|-----------|-------------|
| title | Заголовок | Title       |
| desc  | Описание  | Description |


> **ВАЖНО!** Первый столбец первой строки должен содержать текст `KEY` - это является маркером для поиска строки заголовка.

> **ВАЖНО!** Порядок языков в разных `Категориях` может отличаться.

Во время инициализации необходимо указать `Язык по умолчанию`, а так же подключить `CSV`-данные для каждой категории:
```c#
Localization loc = new Localization ("Russian");
bool ok = loc.AddSource ("...csv-данные-локализации...", "имя-категории");
if (!ok) {
    // Что-то пошло не так - некорректные данные, отсутствующий заголовок и т.д.
}
```
> **ВАЖНО!** Количество категорий не ограничено, каждая должна добавляться отдельным вызовом `AddSource()`.


## Получение значений
Значения можно получать как для текущего, так и для произвольного языка:
```c#
// Запрос для текущего языка - возвращается значение и успех операции.
(string val1, bool ok1) = loc.Get ("имя-ключа", "имя-категории");
// Запрос для указанного языка - возвращается значение и успех операции.
(string val2, bool ok2) = loc.GetFor ("имя-ключа", "имя-категории", "English");
```
> **ВАЖНО!** В случае отсутствия категории, языка, ключа в нем или пустого значения - в качестве значения вернется ключ, а успех операции будет равен false.

Если активный язык отсутствует или значение по ключу в нем пустое, то есть возможность делать автоматический откат на `Язык по умолчанию`:
```c#
Localization loc = new Localization ("Russian");
loc.AddSource ("...csv-данные-локализации-из-примера-выше...", "Common");
// Подключаем автоматический откат на язык по умолчанию.
loc.SetDefaultAsFallback (true);
// Переключаемся на несуществующий язык.
loc.SetLanguage ("Spanish");
(string val1, bool ok1) = loc.Get ("desc", "Common");
(string val2, bool ok2) = loc.GetFor ("desc", "Common", "UnknownLanguage");
(string val3, bool ok3) = loc.Get ("unknown-key", "Common");
(string val4, bool ok4) = loc.GetFor ("unknown-key", "Common", "UnknownLanguage");
// val1 = "Описание", ok1 = true
// val2 = "Описание", ok2 = true
// val3 = "unknown-key", ok1 = false
// val3 = "unknown-key", ok2 = false
```
> **ВАЖНО!** В случае отключенного режима отката на `Язык по умолчанию` (по умолчанию он отключен) все перечисленные выше запросы вернут значение, равное ключу, а успех операции будет равен false.


## Переключение языка
Язык можно переключать на лету:
```c#
loc.SetLanguage("имя-языка");
```
> **ВАЖНО!** Язык должен существовать в списке ключей-языков (первая строка) в нужной `Категории`,
> иначе в качестве локализации вернется имя ключа.

На событие смены языка можно подписаться, реализовав специальный интерфейс:
```c#
class MyLocalize : ILocalizationListener {
    readonly Localization _loc;
    public MyLocalize(Localization loc) {
        _loc = loc;
    }
    public void OnLanguageChanged () {
        // Произошла смена языка, тут
        // можно отреагировать на нее:
        // var val = _loc.Get("key");
    }
}
...
Localization loc = new Localization ("Russian");
loc.AddSource ("...csv-данные-локализации...", "имя-категории");
MyLocalize myLoc = new MyLocalize (loc);
// Подписывание на события.
loc.AddListener (myLoc);
...
// Отписывание от событий.
loc.RemoveListener (myLoc);
```


# Лицензия
Расширение выпускается под коммерческой лицензией, [подробности тут](./LICENSE.md).
