# Пример проекта на LeoECS Proto
Проект представляет собой простую игру "змейка": задача игрока собирать "еду", разбросанную по полю, наращивать хвост и уворачиваться от препятствий в виде стен и своего же хвоста. В силу простоты реализации не реализован пользовательский интерфейс, рестарт игры производится ее полным перезапуском.

> **ВАЖНО!** Требует C#9 (или Unity >=2021.2).

> **ВАЖНО!** Зависит от: **Leopotam.EcsProto**, **Leopotam.EcsProto.ConditionalSystems**, **Leopotam.EcsProto.QoL**, **Leopotam.EcsProto.Unity**. Все эти пакеты следует самостоятельно добавить в проект (например, положив папками в `Assets` рядом с `Client`).

> **ВАЖНО!** Проверено на Unity 2021.3.


# Установка
В чистый проект установить пакеты **Leopotam.EcsProto**, **Leopotam.EcsProto.ConditionalSystems**, **Leopotam.EcsProto.QoL**, **Leopotam.EcsProto.Unity**, затем импортировать `Leopotam.EcsProto.SnakeGame.unitypackage`.


# Структура проекта
Все данные проекта лежат в папке `Client` - это позволяет изолировать их от остальных пакетов, ассетов и прочих настроек unity-проекта. Внутри содержатся папки:
* **Prefabs** - содержит настроенные префабы-контент для "стены", "головы змейки", "тела змейки", "еды" и точки старта. Префабы "стен" и точки старта настроены для использования в редакторе при конструировании границ уровня (авторинг - автоматическое создание ECS-сущностей из префабов).
* **Scenes** - содержит тестовую сцену-уровень.
* **Scripts** - содержит код игры.
* **Settings** - содержит ScriptableObject, содержащий связи между префабами и кодом.


# Код
Стартап сгенерирован через контекстное меню интеграции в редактор unity, папки создавались и наполнялись руками.


## Components
Содержит ECS-компоненты, использующиеся в игре. Все компоненты сведены в аспект, хранящийся в `GameAspect.cs`. Компоненты:
* **Food** - "еда", содержит координаты и ссылку на экземпляр визуального префаба.
* **FoodReposition** - событие, требующее перестановки "еды" на новое место (генерация новой "еды").
* **SnakeBody** - сегмент тела змейки, содержит координаты и ссылку на экземпляр визуального префаба.
* **SnakeDead** - событие, означающее смерть змейки, конец игры.
* **SnakeGrow** - событие, требующее увеличить длину хвоста змейки.
* **SnakeHead** - голова змейки, содержит координаты, ссылку на экземпляр визуального префаба и список сущностей сегментов тела змейки. Сущности тела не могут пропасть просто так, поэтому используются без упаковки. Если потребуется добавлять механики по удалению сущностей сегментов тела, то следует переделать хранение под упакованную версию.
* **Start** - точка старта, авторинг. По координатам этого объекта будет создана голова змейки в начале игры, объект можно перемещать в любое место.
* **UserInput** - компонент пользовательского ввода. Выделение ввода в отдельное сообщение позволит подменить управление на альтернативное (touchscreen или гироскоп) и при этом не потребуется менять остальной код.
* **Wall** - "стена", авторинг. Из экземпляров этого префаба можно собирать уровни, двигая в любое место.


## Settings
Содержит ScriptableObject `GameSettings` - настройки, префабы и обеспечивает доступ к ним из кода.


## Systems
Содержит ECS-системы, использующиеся в игре:
* **FoodConsumeSystem** - обеспечивает проверки на пересечение головы змейки с едой, инициирует событие переноса еды на новое место и событие роста хвоста змейки.
* **FoodSpawnSystem** - определяет границы игровой зоны по "стенам", создает экземпляр "еды" и переставляет его на новое место при получении события.
* **SnakeCheckBodySystem** - проверяет пересечение головы змейки с ее хвостом, инициирует событие смерти.
* **SnakeDeadSystem** - проверяет наступление смерти, удаляет голову змейки, конец игры.
* **SnakeGrowSystem** - выполняет рост хвоста змейки по событию. Змейка растет в сторону голову, новые сегменты вставляются в конец списка сегментов тела в компоненте головы, сами сегменты идут в порядке от хвоста к голове.
* **SnakeInputSystem** - применяет событие пользовательского ввода к голове змейки.
* **SnakeMoveBodySystem** - выполняет движение тела змейки через перестановку сегментов тела от хвоста к голове.
* **SnakeMoveHeadSystem** - выполняет движение головы змейки через перестановку сегментов тела от хвоста к голове.
* **SnakeSpawnSystem** - создает экземпляр головы змейки по маркеру старта.
* **UserInputSystem** - Принимает ввод с клавиатуры/контроллера и создает по нему ECS-событие пользовательского ввода.
* **WallCheckSystem** - проверяет пересечение головы змейки со "стенами".


## Views
Содержит `Monobehaviour`-компоненты, отвечающие за управление визуальным контентом:
* **FoodView** - управляет визуальным префабом "еды".
* **PositionAligner** - вспомогательный код для редактора, помогающий автоматически выравнивать координаты префабов по целым координатам.
* **SnakeView** - управляет визуальным префабом головы/тела змейки.


## GameStartup
Содержит стартап-код инициализации ECS-окружения, определяющий порядок выполнения систем.
